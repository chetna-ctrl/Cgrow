# âš¡ Supabase Setup & SQL Schema

Since I cannot create tables for you without your keys, please run this SQL script in your **Supabase Dashboard** > **SQL Editor**.

This will create all the necessary tables for Agri OS, including the **IoT Sensor Data** table.

```sql
-- 1. Enable Row Level Security (RLS) is good practice, but for MVP we'll keep it simple first.

-- ---------------------------------------------------------
-- TABLE 1: DAILY LOGS (Replaces localDailyLogs)
-- ---------------------------------------------------------
create table public.daily_logs (
  id bigint generated by default as identity primary key,
  created_at timestamp with time zone default timezone('utc'::text, now()) not null,
  user_id uuid references auth.users not null,
  system_id text, -- e.g. "NFT-1"
  ph numeric,
  ec numeric,
  temp numeric,
  notes text,
  status text
);

-- ---------------------------------------------------------
-- TABLE 2: MICROGREENS BATCHES
-- ---------------------------------------------------------
create table public.batches (
  id bigint generated by default as identity primary key,
  created_at timestamp with time zone default timezone('utc'::text, now()) not null,
  user_id uuid references auth.users not null,
  batch_id text, -- e.g. "B001"
  crop text,
  tray_id text,
  sow_date date,
  harvest_date date,
  yield_grams numeric default 0,
  status text -- "Growing", "Harvested", etc
);

-- ---------------------------------------------------------
-- TABLE 3: IOT SENSOR READINGS (For your ESP32)
-- ---------------------------------------------------------
create table public.sensor_readings (
  id bigint generated by default as identity primary key,
  created_at timestamp with time zone default timezone('utc'::text, now()) not null,
  device_id text, -- e.g. "ESP32-A"
  ph numeric,
  ec numeric,
  water_temp numeric,
  air_temp numeric,
  humidity numeric
);

-- ---------------------------------------------------------
-- PERMISSIONS (MVP Style - Open for Authenticated Users)
-- ---------------------------------------------------------
alter table public.daily_logs enable row level security;
alter table public.batches enable row level security;
alter table public.sensor_readings enable row level security;

-- Policy: Users can see only their own data
create policy "Users can view their own logs" on public.daily_logs
  for select using (auth.uid() = user_id);

create policy "Users can insert their own logs" on public.daily_logs
  for insert with check (auth.uid() = user_id);

create policy "Users can view their own batches" on public.batches
  for select using (auth.uid() = user_id);

create policy "Users can insert their own batches" on public.batches
  for insert with check (auth.uid() = user_id);
  
-- Policy: Allow reading sensor data (Public for dashboard)
create policy "Enable read access for all users" on public.sensor_readings
  for select using (true);
  
-- Policy: Allow API/Devices to insert sensor data
create policy "Enable insert for all" on public.sensor_readings
  for insert with check (true);
```

## ğŸš€ Next Steps
1.  **Copy the SQL above**.
2.  Go to [supabase.com/dashboard](https://supabase.com/dashboard).
3.  Click **SQL Editor** (sidebar) -> **New Query**.
4.  Paste and clicked **Run**.
5.  **Success!** Your cloud database is ready.
